cmake_minimum_required(VERSION 3.22.0)

project(onnx_extended VERSION 0.1.0)

# This comes to hand if we also need to use the NumPy C API
exec_program(${PYTHON_EXECUTABLE}
             ARGS "-c \"import numpy; print(numpy.get_include())\""
             OUTPUT_VARIABLE NUMPY_INCLUDE_DIR
             RETURN_VALUE NUMPY_NOT_FOUND
            )
if(NUMPY_NOT_FOUND)
    message(FATAL_ERROR "NumPy headers not found")
endif()

include(CTest)
enable_testing()

find_package(pybind11 CONFIG)
if(NOT pybind11_FOUND)
  message(FATAL_ERROR "cannot find pybind")
endif()

add_subdirectory(pybind11)
pybind11_add_module(_validation
    onnx_extended/validation/_validation.cpp
    onnx_extended/validation/speed_metrics.cpp)

set(CPACK_PROJECT_NAME ${PROJECT_NAME})
set(CPACK_PROJECT_VERSION ${PROJECT_VERSION})
include(CPack)
